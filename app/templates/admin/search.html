{% extends "admin/base.html" %}

{% block title %}
Search - Admin Panel
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Admin Search</h2>

    <!-- Search Form -->
    <form method="get" action="{{ url_for('admin.admin_search') }}">
        <div class="form-row align-items-center">
            <div class="col-md-3 mb-3">
                <label for="type" class="form-label">Search Type</label>
                <select class="form-control" name="type" id="type">
                    <option value="service" {% if search_type == 'service' %}selected{% endif %}>Services</option>
                    <option value="customer" {% if search_type == 'customer' %}selected{% endif %}>Customers</option>
                    <option value="professional" {% if search_type == 'professional' %}selected{% endif %}>Professionals</option>
                    <option value="service_request" {% if search_type == 'service_request' %}selected{% endif %}>Service Requests</option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="query" class="form-label">Search Query</label>
                <input type="text" class="form-control" name="query" id="query" placeholder="Enter search query" value="{{ query }}">
            </div>
            <div class="col-md-3 mb-3">
                <button type="submit" class="btn btn-primary btn-block">Search</button>
            </div>
        </div>
    </form>

    <hr class="my-4">

    <!-- Results Table -->
    {% if results %}
        <h3 class="mb-4">Results</h3>
        <table class="table table-bordered table-striped table-hover table-sm">
            <thead class="table-dark">
                {% if search_type == 'service' %}
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Base Price</th>
                </tr>
                {% elif search_type == 'customer' or search_type == 'professional' %}
                <tr>
                    <th>ID</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Address</th>
                </tr>
                {% elif search_type == 'service_request' %}
                <tr>
                    <th>ID</th>
                    <th>Service</th>
                    <th>Customer</th>
                    <th>Professional</th>
                    <th>Status</th>
                    <th>Requested Date</th>
                </tr>
                {% endif %}
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    {% if search_type == 'service' %}
                    <td>{{ result.id }}</td>
                    <td>{{ result.name }}</td>
                    <td>{{ result.description }}</td>
                    <td>{{ result.base_price }}</td>
                    {% elif search_type == 'customer' or search_type == 'professional' %}
                    <td>{{ result.id }}</td>
                    <td>{{ result.fullname }}</td>
                    <td>{{ result.email }}</td>
                    <td>{{ result.address }}</td>
                    {% elif search_type == 'service_request' %}
                    <td>{{ result.id }}</td>
                    <td>{{ result.service.name }}</td>
                    <td>{{ result.customer.fullname }}</td>
                    <td>{{ result.professional.fullname if result.professional else 'Unassigned' }}</td>
                    <td>{{ result.status }}</td>
                    <td>{{ result.created_at.strftime('%Y-%m-%d') }}</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No results found{% if query %} for "{{ query }}"{% endif %}.</p>
    {% endif %}
</div>

{% endblock %}
